[Interface]
Address = {{ vpn_ip }}/16
ListenPort = {{ vpn_port }}
PrivateKey = {{ wg_private_key }}

{% for host in groups['vpn'] %}
{% if host != inventory_hostname %}
[Peer]
PublicKey = {{ hostvars[host].wg_public_key }}
AllowedIPs = {{ hostvars[host].vpn_ip }}/32
Endpoint = {{ hostvars[host].ansible_facts['default_ipv4']['address'] }}:{{ vpn_port }}
PersistentKeepalive = 25

{% endif %}
{% endfor %}
